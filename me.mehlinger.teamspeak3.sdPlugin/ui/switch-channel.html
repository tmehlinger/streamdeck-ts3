<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Switch Channel Settings</title>
        <style>
            body {
            	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            	padding: 10px;
            	margin: 0;
            	background: transparent;
            }
            .sdpi-wrapper {
            	padding: 0;
            }
            .sdpi-item {
            	margin-bottom: 15px;
            }
            .sdpi-item-label {
            	display: block;
            	margin-bottom: 5px;
            	font-size: 12px;
            	font-weight: 500;
            	color: #d4d4d4;
            }
            .sdpi-item-value input {
            	width: 100%;
            	padding: 6px 8px;
            	font-size: 12px;
            	background: #3a3a3a;
            	border: 1px solid #505050;
            	border-radius: 3px;
            	color: #d4d4d4;
            	box-sizing: border-box;
            }
            .sdpi-item-value input:focus {
            	outline: none;
            	border-color: #0e94eb;
            }
            .sdpi-item-description {
            	font-size: 11px;
            	color: #969696;
            	margin-top: 5px;
            	line-height: 1.4;
            }
            .sdpi-section-header {
            	font-size: 13px;
            	font-weight: 600;
            	color: #d4d4d4;
            	margin-top: 20px;
            	margin-bottom: 10px;
            	padding-bottom: 5px;
            	border-bottom: 1px solid #505050;
            }
        </style>
    </head>
    <body>
        <div class="sdpi-wrapper">
            <div class="sdpi-item">
                <div class="sdpi-item-label">Channel Name</div>
                <div class="sdpi-item-value">
                    <input type="text" id="channelName" placeholder="e.g., Lobby" />
                </div>
                <div class="sdpi-item-description">
                    Enter the exact name of the TeamSpeak channel you want to switch to when this button is pressed.
                </div>
            </div>

            <div class="sdpi-item">
                <div class="sdpi-item-label">Channel Password (Optional)</div>
                <div class="sdpi-item-value">
                    <input type="password" id="channelPassword" placeholder="Leave blank if no password" />
                </div>
                <div class="sdpi-item-description">
                    Enter the channel password if the channel is password-protected.
                </div>
            </div>

            <div class="sdpi-section-header">TeamSpeak 3 Connection</div>

            <div class="sdpi-item">
                <div class="sdpi-item-label">API Key</div>
                <div class="sdpi-item-value">
                    <input type="password" id="apiKey" placeholder="Enter your ClientQuery API key" />
                </div>
                <div class="sdpi-item-description">
                    Generate an API key in TeamSpeak 3: Tools → Options → Addons → ClientQuery → Settings.
                </div>
            </div>

            <div class="sdpi-item">
                <div class="sdpi-item-label">Host</div>
                <div class="sdpi-item-value">
                    <input type="text" id="host" placeholder="127.0.0.1" />
                </div>
                <div class="sdpi-item-description">Default: 127.0.0.1</div>
            </div>

            <div class="sdpi-item">
                <div class="sdpi-item-label">Port</div>
                <div class="sdpi-item-value">
                    <input type="number" id="port" placeholder="25639" />
                </div>
                <div class="sdpi-item-description">Default: 25639</div>
            </div>
        </div>

        <script>
            let websocket = null;
            let uuid = null;
            let actionInfo = {};

            function connectElgatoStreamDeckSocket(inPort, inUUID, inRegisterEvent, inInfo, inActionInfo) {
            	uuid = inUUID;
            	actionInfo = JSON.parse(inActionInfo);
            	websocket = new WebSocket('ws://127.0.0.1:' + inPort);

            	websocket.onopen = function() {
            		const json = {
            			event: inRegisterEvent,
            			uuid: inUUID
            		};
            		websocket.send(JSON.stringify(json));

            		// Request current settings
            		requestSettings();
            		requestGlobalSettings();
            	};

            	websocket.onmessage = function(evt) {
            		const jsonObj = JSON.parse(evt.data);

            		if (jsonObj.event === 'didReceiveSettings') {
            			const settings = jsonObj.payload.settings;

            			// Update UI with current action settings
            			if (settings.channelName) {
            				document.getElementById('channelName').value = settings.channelName;
            			}
            			if (settings.channelPassword) {
            				document.getElementById('channelPassword').value = settings.channelPassword;
            			}
            		}

            		if (jsonObj.event === 'didReceiveGlobalSettings') {
            			const settings = jsonObj.payload.settings;

            			// Update UI with current global settings
            			if (settings.apiKey) {
            				document.getElementById('apiKey').value = settings.apiKey;
            			}
            			if (settings.host) {
            				document.getElementById('host').value = settings.host;
            			}
            			if (settings.port) {
            				document.getElementById('port').value = settings.port;
            			}
            		}
            	};
            }

            function requestSettings() {
            	if (websocket) {
            		const json = {
            			event: 'getSettings',
            			context: uuid
            		};
            		websocket.send(JSON.stringify(json));
            	}
            }

            function requestGlobalSettings() {
            	if (websocket) {
            		const json = {
            			event: 'getGlobalSettings',
            			context: uuid
            		};
            		websocket.send(JSON.stringify(json));
            	}
            }

            function setSettings(settings) {
            	if (websocket) {
            		const json = {
            			event: 'setSettings',
            			context: uuid,
            			payload: settings
            		};
            		websocket.send(JSON.stringify(json));
            	}
            }

            function setGlobalSettings(settings) {
            	if (websocket) {
            		const json = {
            			event: 'setGlobalSettings',
            			context: uuid,
            			payload: settings
            		};
            		websocket.send(JSON.stringify(json));
            	}
            }

            // Handle input changes
            document.addEventListener('DOMContentLoaded', function() {
            	// Action-specific settings
            	document.getElementById('channelName').addEventListener('input', function(e) {
            		const settings = {
            			channelName: e.target.value,
            			channelPassword: document.getElementById('channelPassword').value
            		};
            		setSettings(settings);
            	});

            	document.getElementById('channelPassword').addEventListener('input', function(e) {
            		const settings = {
            			channelName: document.getElementById('channelName').value,
            			channelPassword: e.target.value
            		};
            		setSettings(settings);
            	});

            	// Global settings
            	document.getElementById('apiKey').addEventListener('input', function(e) {
            		const settings = {
            			apiKey: e.target.value,
            			host: document.getElementById('host').value || '127.0.0.1',
            			port: parseInt(document.getElementById('port').value) || 25639
            		};
            		setGlobalSettings(settings);
            	});

            	document.getElementById('host').addEventListener('input', function(e) {
            		const settings = {
            			apiKey: document.getElementById('apiKey').value,
            			host: e.target.value || '127.0.0.1',
            			port: parseInt(document.getElementById('port').value) || 25639
            		};
            		setGlobalSettings(settings);
            	});

            	document.getElementById('port').addEventListener('input', function(e) {
            		const settings = {
            			apiKey: document.getElementById('apiKey').value,
            			host: document.getElementById('host').value || '127.0.0.1',
            			port: parseInt(e.target.value) || 25639
            		};
            		setGlobalSettings(settings);
            	});
            });
        </script>
    </body>
</html>
